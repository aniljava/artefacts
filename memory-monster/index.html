<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Memory Game</title>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet"> -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
        }

        #root {
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- React and Babel for JSX -->
    <script src="script/react.production.min.js"></script>
    <script src="script/react-dom.production.min.js"></script>
    <script src="script/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // UPDATE THESE URLs to your GitHub Pages hosted images

        // Monster data: 36 monsters total (12 from each sprite sheet)

        const DEFAULT_COLS = 6;
        const DEFAULT_ROWS = 5;
        const PREVIEW_LENGTH = 10;
        const GRID_CONFIG_KEY = 'monsterMemoryGridConfig';


        const MONSTERS = [
            // Sheet 1
            { id: 1, url: 'img/1/1.jpg', name: 'Furry Frank', color: '#F39C12' },
            { id: 2, url: 'img/1/2.jpg', name: 'Wendy', color: '#9B59B6' },
            { id: 3, url: 'img/1/3.jpg', name: 'Spike', color: '#3498DB' },
            { id: 4, url: 'img/1/4.jpg', name: 'Draco', color: '#27AE60' },
            { id: 5, url: 'img/1/5.jpg', name: 'Cyclops Sam', color: '#8E44AD' },
            { id: 6, url: 'img/1/6.jpg', name: 'Lila', color: '#E91E63' },
            { id: 7, url: 'img/1/7.jpg', name: 'Marty', color: '#8BC34A' },
            { id: 8, url: 'img/1/8.jpg', name: 'Zappa', color: '#E74C3C' },
            { id: 9, url: 'img/1/9.jpg', name: 'Count Fang', color: '#2C3E50' },
            { id: 10, url: 'img/1/10.jpg', name: 'Buzzy', color: '#F1C40F' },
            { id: 11, url: 'img/1/11.jpg', name: 'Nessie', color: '#3498DB' },
            { id: 12, url: 'img/1/12.jpg', name: 'Rocky', color: '#795548' },
            { id: 13, url: 'img/2/1.jpg', name: 'Squee', color: '#E91E63' },
            { id: 14, url: 'img/2/2.jpg', name: 'Grumble', color: '#4CAF50' },
            { id: 15, url: 'img/2/3.jpg', name: 'Spark', color: '#9C27B0' },
            { id: 16, url: 'img/2/4.jpg', name: 'Oozebert', color: '#8BC34A' },
            { id: 17, url: 'img/2/5.jpg', name: 'Bumble', color: '#FF9800' },
            { id: 18, url: 'img/2/6.jpg', name: 'Clara', color: '#E91E63' },
            { id: 19, url: 'img/2/7.jpg', name: 'Webster', color: '#3F51B5' },
            { id: 20, url: 'img/2/8.jpg', name: 'Stomper', color: '#2196F3' },
            { id: 21, url: 'img/2/9.jpg', name: 'Tombster', color: '#4CAF50' },
            { id: 22, url: 'img/2/10.jpg', name: 'Giggles', color: '#FF5722' },
            { id: 23, url: 'img/2/11.jpg', name: 'Blip', color: '#8BC34A' },
            { id: 24, url: 'img/2/12.jpg', name: 'Gnash', color: '#607D8B' },
            { id: 25, url: 'img/3/1.jpg', name: 'Popcap', color: '#3F51B5' },
            { id: 26, url: 'img/3/2.jpg', name: 'Gobbles', color: '#9C27B0' },
            { id: 27, url: 'img/3/3.jpg', name: 'Starlah', color: '#FFC107' },
            { id: 28, url: 'img/3/4.jpg', name: 'Thorn', color: '#4CAF50' },
            { id: 29, url: 'img/3/5.jpg', name: 'Snappy', color: '#03A9F4' },
            { id: 30, url: 'img/3/6.jpg', name: 'Whiskers', color: '#FF9800' },
            { id: 31, url: 'img/3/7.jpg', name: 'Ivan', color: '#90CAF9' },
            { id: 32, url: 'img/3/8.jpg', name: 'Fizzle', color: '#FF5722' },
            { id: 33, url: 'img/3/9.jpg', name: 'Dribble', color: '#7E57C2' },
            { id: 34, url: 'img/3/10.jpg', name: 'Glub', color: '#26A69A' },
            { id: 35, url: 'img/3/11.jpg', name: 'Zozo', color: '#FFEB3B' },
            { id: 36, url: 'img/3/12.jpg', name: 'Chomp', color: '#FF5722' },
        ];

        const GAME_STATES = {
            START: 'start',
            PREVIEW: 'preview',
            PLAYING: 'playing',
            WON: 'won',
        };

        const STORAGE_KEY = 'monsterMemoryData';

        // Load grid config from localStorage
        const loadGridConfig = () => {
            try {
                const data = localStorage.getItem(GRID_CONFIG_KEY);
                if (data) {
                    const config = JSON.parse(data);
                    return { rows: config.rows || DEFAULT_ROWS, cols: config.cols || DEFAULT_COLS };
                }
            } catch (e) {
                console.error('Error loading grid config:', e);
            }
            return { rows: DEFAULT_ROWS, cols: DEFAULT_COLS };
        };

        // Save grid config to localStorage
        const saveGridConfig = (rows, cols) => {
            try {
                localStorage.setItem(GRID_CONFIG_KEY, JSON.stringify({ rows, cols }));
            } catch (e) {
                console.error('Error saving grid config:', e);
            }
        };

        // Load data from localStorage
        const loadStorageData = () => {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) {
                    return JSON.parse(data);
                }
            } catch (e) {
                console.error('Error loading storage:', e);
            }
            return { leaderboard: [], players: [] };
        };

        // Save data to localStorage
        const saveStorageData = (data) => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (e) {
                console.error('Error saving storage:', e);
            }
        };

        // Shuffle array using Fisher-Yates
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // Monster sprite component
        const MonsterSprite = ({ monster, size = 60 }) => {
            //   monster image is contained at moster.  
            const imgWidth = 110;
            const imgHeight = 135;



            return (
                <div style={{
                    width: imgWidth,
                    height: imgHeight,
                    position: 'relative',
                    overflow: 'hidden',
                    borderRadius: '1px',
                }}>
                    <img src={monster.url}
                        style={{
                            width: '100%',
                            height: '100%',

                        }}
                    />
                </div>
            );
        };

        // Card component
        const Card = ({ card, isFlipped, isMatched, onClick, previewMode, gridSize }) => {
            const showFront = isFlipped || isMatched || previewMode;
            //   const cardSize = gridSize === 6 ? 'clamp(50px, 12vw, 90px)' : 'clamp(60px, 15vw, 100px)';
            const cardSize = 'clamp(50px, 12vw, 150px)';

            const cardWidth = 'clamp(50px, 12vw, 110px)';
            const cardHeight = 'clamp(50px, 12vw, 135px)';

            return (
                <div
                    onClick={onClick}
                    className={`card-container ${isMatched ? 'matched' : ''}`}
                    style={{
                        perspective: '1000px',
                        width: cardWidth,
                        height: cardHeight,
                        cursor: isMatched ? 'default' : 'pointer',
                    }}
                >
                    <div
                        className="card-inner"
                        style={{
                            position: 'relative',
                            width: '100%',
                            height: '100%',
                            transformStyle: 'preserve-3d',
                            transform: showFront ? 'rotateY(180deg)' : 'rotateY(0deg)',
                        }}
                    >
                        {/* Back of card */}
                        <div
                            style={{
                                position: 'absolute',
                                width: '100%',
                                height: '100%',
                                backfaceVisibility: 'hidden',
                                borderRadius: '5px',
                                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                boxShadow: '0 4px 20px rgba(102, 126, 234, 0.3), inset 0 2px 0 rgba(255,255,255,0.2)',
                                border: '1px solid rgba(255,255,255,0.3)',
                            }}
                        >
                            <div style={{ fontSize: 'clamp(1.2rem, 4vw, 2rem)', opacity: 0.9 }}>‚ùì</div>
                            <div style={{
                                position: 'absolute',
                                inset: '4px',
                                border: '2px dashed rgba(255,255,255,0.2)',
                                borderRadius: '2px',
                                pointerEvents: 'none',
                            }} />
                        </div>

                        {/* Front of card (monster) */}
                        <div
                            style={{
                                position: 'absolute',
                                width: '100%',
                                height: '100%',
                                backfaceVisibility: 'hidden',
                                transform: 'rotateY(180deg)',
                                borderRadius: '2px',
                                background: `linear-gradient(135deg, ${card.color}30 0%, ${card.color}60 100%)`,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                boxShadow: `0 4px 20px ${card.color}30`,
                                border: `1px solid ${card.color}`,
                                overflow: 'hidden',
                            }}
                        >
                            <MonsterSprite monster={card} size={parseInt(cardSize) || 70} />
                        </div>
                    </div>
                </div>
            );
        };

        // Player selector component
        const PlayerSelector = ({ players, selectedPlayer, onSelect, onNewPlayer }) => {
            if (players.length === 0) return null;

            return (
                <div style={{
                    background: 'rgba(255,255,255,0.08)',
                    borderRadius: '2px',
                    padding: '16px',
                    marginBottom: '20px',
                    border: '1px solid rgba(255,255,255,0.1)',
                }}>
                    <div style={{
                        fontFamily: '"Roboto", cursive',
                        color: '#FFD93D',
                        fontSize: '0.9rem',
                        marginBottom: '12px',
                        textAlign: 'center',
                    }}>
                        PLAYER:
                    </div>
                    <div style={{
                        display: 'flex',
                        flexWrap: 'wrap',
                        gap: '16px',
                        justifyContent: 'center',
                    }}>
                        {players.slice(0, 8).map((player, idx) => (
                            <button
                                key={idx}
                                onClick={() => onSelect(player)}
                                style={{
                                    padding: '8px 16px',
                                    borderRadius: '2px',
                                    border: selectedPlayer === player
                                        ? '2px solid #6BCB77'
                                        : '2px solid rgba(255,255,255,0.2)',
                                    background: selectedPlayer === player
                                        ? 'rgba(107, 203, 119, 0.3)'
                                        : 'rgba(255,255,255,0.1)',
                                    color: 'white',
                                    fontFamily: '"Roboto", cursive',
                                    fontSize: '0.9rem',
                                    cursor: 'pointer',
                                    transition: 'all 0.1s ease',
                                }}
                            >
                                {player}
                            </button>
                        ))}
                        <button
                            onClick={onNewPlayer}
                            style={{
                                padding: '8px 16px',
                                borderRadius: '2px',
                                border: '2px dashed rgba(255,255,255,0.3)',
                                background: 'transparent',
                                color: 'rgba(255,255,255,0.7)',
                                fontFamily: '"Roboto", cursive',
                                fontSize: '0.9rem',
                                cursor: 'pointer',
                            }}
                        >
                            + New Player
                        </button>
                    </div>
                    

                </div>
            );
        };

        // Leaderboard component
        const Leaderboard = ({ scores, gridRows, gridCols, onGridChange }) => {
            const [tempRows, setTempRows] = useState(gridRows);
            const [tempCols, setTempCols] = useState(gridCols);
            const [error, setError] = useState('');

            // Sync temp values when props change
            useEffect(() => {
                setTempRows(gridRows);
                setTempCols(gridCols);
            }, [gridRows, gridCols]);

            const sortedScores = [...scores].sort((a, b) => a.score - b.score).slice(0, 5);

            return (
                <div style={{
                    background: 'rgba(255,255,255,0.1)',
                    backdropFilter: 'blur(10px)',
                    borderRadius: '2px',
                    padding: '20px',
                    border: '2px solid rgba(255,255,255,0.2)',
                }}>
                    {sortedScores.length > 0 && (
                        <>
                            <h3 style={{
                                fontFamily: '"Roboto", cursive',
                                fontSize: '1.3rem',
                                marginBottom: '15px',
                                textAlign: 'center',
                                color: '#FFD93D',
                                textShadow: '2px 2px 0 #FF6B35',
                            }}>
                                üèÜ Champions üèÜ
                            </h3>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                {sortedScores.map((entry, index) => (
                                    <div
                                        key={index}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '10px',
                                            padding: '8px 12px',
                                            background: index === 0
                                                ? 'linear-gradient(90deg, #FFD700 0%, #FFA500 100%)'
                                                : index === 1
                                                    ? 'linear-gradient(90deg, #C0C0C0 0%, #A8A8A8 100%)'
                                                    : index === 2
                                                        ? 'linear-gradient(90deg, #CD7F32 0%, #B87333 100%)'
                                                        : 'rgba(255,255,255,0.1)',
                                            borderRadius: '2px',
                                            fontFamily: '"Roboto", cursive',
                                            fontSize: '0.9rem',
                                            color: index < 3 ? '#1a1a2e' : 'white',
                                        }}
                                    >
                                        <span style={{ fontSize: '1.1rem' }}>
                                            {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`}
                                        </span>
                                        <span style={{ flex: 1 }}>{entry.name}</span>
                                        <span style={{
                                            fontWeight: 'bold',
                                            background: index < 3 ? 'rgba(0,0,0,0.2)' : 'rgba(255,255,255,0.2)',
                                            padding: '3px 10px',
                                            borderRadius: '2px',
                                            fontSize: '0.85rem',
                                        }}>
                                            {entry.score} tries
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </>
                    )}
                    <div style={{
                        background: 'rgba(255,255,255,0.1)',
                        backdropFilter: 'blur(10px)',
                        borderRadius: '2px',
                        padding: '20px',
                        marginTop: '15px',
                        border: '2px solid rgba(255,255,255,0.2)',
                    }}>
                        <h4 style={{
                            fontFamily: '"Roboto", cursive',
                            fontSize: '1rem',
                            marginBottom: '12px',
                            textAlign: 'center',
                            color: '#FFD93D',
                        }}>
                            Grid Size
                        </h4>
                        <div style={{
                            display: 'flex',
                            gap: '15px',
                            alignItems: 'center',
                            justifyContent: 'center',
                            flexWrap: 'wrap',
                        }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <label style={{ color: 'white', fontFamily: '"Roboto", cursive', fontSize: '0.9rem' }}>Rows:</label>
                                <input
                                    type="number"
                                    min="2"
                                    max="8"
                                    value={tempRows}
                                    onChange={(e) => setTempRows(parseInt(e.target.value) || 2)}
                                    style={{
                                        width: '60px',
                                        padding: '6px 10px',
                                        borderRadius: '8px',
                                        border: 'none',
                                        background: 'rgba(255,255,255,0.9)',
                                        fontFamily: '"Roboto", cursive',
                                        textAlign: 'center',
                                        fontSize: '0.9rem',
                                    }}
                                />
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <label style={{ color: 'white', fontFamily: '"Roboto", cursive', fontSize: '0.9rem' }}>Cols:</label>
                                <input
                                    type="number"
                                    min="2"
                                    max="9"
                                    value={tempCols}
                                    onChange={(e) => setTempCols(parseInt(e.target.value) || 2)}
                                    style={{
                                        width: '60px',
                                        padding: '6px 10px',
                                        borderRadius: '8px',
                                        border: 'none',
                                        background: 'rgba(255,255,255,0.9)',
                                        fontFamily: '"Roboto", cursive',
                                        textAlign: 'center',
                                        fontSize: '0.9rem',
                                    }}
                                />
                            </div>
                            <button
                                onClick={() => {
                                    setError('');
                                    if ((tempRows * tempCols) % 2 !== 0) {
                                        setError('Total cards must be even!');
                                        return;
                                    }
                                    if ((tempRows * tempCols) / 2 > 36) {
                                        setError('Max 36 pairs (72 cards)');
                                        return;
                                    }
                                    if (onGridChange) {
                                        onGridChange(tempRows, tempCols);
                                    }
                                }}
                                style={{
                                    padding: '6px 16px',
                                    borderRadius: '8px',
                                    border: 'none',
                                    background: 'linear-gradient(135deg, #6BCB77 0%, #4CAF50 100%)',
                                    color: 'white',
                                    fontFamily: '"Roboto", cursive',
                                    fontSize: '0.85rem',
                                    cursor: 'pointer',
                                }}
                            >
                                Apply
                            </button>
                        </div>
                        {error && (
                            <div style={{
                                color: '#FF6B6B',
                                fontSize: '0.8rem',
                                marginTop: '8px',
                                textAlign: 'center',
                                fontFamily: '"Roboto", cursive',
                            }}>
                                {error}
                            </div>
                        )}
                        <div style={{
                            color: 'rgba(255,255,255,0.6)',
                            fontSize: '0.75rem',
                            marginTop: '8px',
                            textAlign: 'center',
                            fontFamily: '"Roboto", cursive',
                        }}>
                            Current: {gridRows} x {gridCols} = {gridRows * gridCols} cards ({(gridRows * gridCols) / 2} pairs)
                        </div>
                    </div>
                    
                </div>
            );
        };

        // Confetti component
        const Confetti = () => {
            const colors = ['#FF6B35', '#FFD93D', '#6BCB77', '#4D96FF', '#9B59B6', '#E91E63'];
            const confetti = Array.from({ length: 50 }, (_, i) => ({
                id: i,
                left: Math.random() * 100,
                delay: Math.random() * 2,
                duration: 2 + Math.random() * 2,
                color: colors[Math.floor(Math.random() * colors.length)],
                size: 8 + Math.random() * 8,
            }));

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    pointerEvents: 'none',
                    overflow: 'hidden',
                    zIndex: 1000,
                }}>
                    {confetti.map((c) => (
                        <div
                            key={c.id}
                            style={{
                                position: 'absolute',
                                left: `${c.left}%`,
                                top: '-20px',
                                width: `${c.size}px`,
                                height: `${c.size}px`,
                                background: c.color,
                                borderRadius: Math.random() > 0.5 ? '50%' : '2px',
                                animation: `confettiFall ${c.duration}s ease-in ${c.delay}s infinite`,
                            }}
                        />
                    ))}
                </div>
            );
        };

        // Main game component
        function MonsterMemory() {
            const [gameState, setGameState] = useState(GAME_STATES.START);
            const [cards, setCards] = useState([]);
            const [flippedIndices, setFlippedIndices] = useState([]);
            const [matchedPairs, setMatchedPairs] = useState([]);
            const [tries, setTries] = useState(0);
            const [playerName, setPlayerName] = useState('');
            const [leaderboard, setLeaderboard] = useState([]);
            const [knownPlayers, setKnownPlayers] = useState([]);
            const [previewCountdown, setPreviewCountdown] = useState(1);
            const [showNewPlayerInput, setShowNewPlayerInput] = useState(false);
            const [imagesLoaded, setImagesLoaded] = useState(true);

            // Grid configuration state
            const [gridRows, setGridRows] = useState(DEFAULT_ROWS);
            const [gridCols, setGridCols] = useState(DEFAULT_COLS);
            const totalCards = (gridRows * gridCols) / 2;

            // Load saved data on mount
            useEffect(() => {
                const data = loadStorageData();
                setLeaderboard(data.leaderboard || []);
                setKnownPlayers(data.players || []);
                if (data.players?.length === 0) {
                    setShowNewPlayerInput(true);
                }
                // Load grid config
                const gridConfig = loadGridConfig();
                setGridRows(gridConfig.rows);
                setGridCols(gridConfig.cols);
            }, []);

            // Handle grid config changes
            const handleGridChange = (newRows, newCols) => {
                // Ensure rows * cols is even (for pairs)
                if ((newRows * newCols) % 2 !== 0) {
                    return false;
                }
                // Ensure we have enough monsters (max 36 pairs)
                if ((newRows * newCols) / 2 > MONSTERS.length) {
                    return false;
                }
                setGridRows(newRows);
                setGridCols(newCols);
                saveGridConfig(newRows, newCols);
                return true;
            };



            // Initialize game cards based on grid configuration
            const initializeCards = useCallback(() => {
                const selectedMonsters = shuffleArray(MONSTERS).slice(0, totalCards);
                const pairs = [...selectedMonsters, ...selectedMonsters];
                const shuffledCards = shuffleArray(pairs).map((monster, idx) => ({
                    ...monster,
                    uniqueId: `${monster.id}-${idx}`,
                }));
                setCards(shuffledCards);
                setFlippedIndices([]);
                setMatchedPairs([]);
                setTries(0);
            }, [totalCards]);

            // Start game
            const startGame = (name) => {
                const activeName = (typeof name === 'string') ? name : playerName;
                console.log("STARTING GAME")
                if (activeName.trim().length < 2) return;

                // Add to known players if new
                const trimmedName = activeName.trim();
                if (!knownPlayers.includes(trimmedName)) {
                    const newPlayers = [trimmedName, ...knownPlayers].slice(0, 10);
                    setKnownPlayers(newPlayers);
                    const data = loadStorageData();
                    saveStorageData({ ...data, players: newPlayers });
                }

                initializeCards();
                setGameState(GAME_STATES.PREVIEW);
                setPreviewCountdown(PREVIEW_LENGTH);
            };

            // Preview countdown
            useEffect(() => {
                if (gameState !== GAME_STATES.PREVIEW) return;

                if (previewCountdown > 0) {
                    const timer = setTimeout(() => setPreviewCountdown(prev => prev - 1), 1000);
                    return () => clearTimeout(timer);
                } else {
                    setGameState(GAME_STATES.PLAYING);
                }
            }, [gameState, previewCountdown]);

            // Handle card click
            const handleCardClick = (index) => {
                if (gameState !== GAME_STATES.PLAYING) return;
                if (flippedIndices.includes(index)) return;
                if (matchedPairs.includes(cards[index].id)) return;
                if (flippedIndices.length >= 2) return;

                const newFlipped = [...flippedIndices, index];
                setFlippedIndices(newFlipped);

                if (newFlipped.length === 2) {
                    setTries(prev => prev + 1);
                    const [first, second] = newFlipped;

                    if (cards[first].id === cards[second].id) {
                        setTimeout(() => {
                            setMatchedPairs(prev => [...prev, cards[first].id]);
                            setFlippedIndices([]);
                        }, 200);
                    } else {
                        setTimeout(() => setFlippedIndices([index]), 500);
                    }
                }
            };

            // Check for win
            useEffect(() => {
                if (matchedPairs.length === totalCards && gameState === GAME_STATES.PLAYING) {
                    setTimeout(() => {
                        setGameState(GAME_STATES.WON);
                        const newEntry = { name: playerName.trim(), score: tries };
                        const newLeaderboard = [...leaderboard, newEntry]
                            .sort((a, b) => a.score - b.score)
                            .slice(0, 10);
                        setLeaderboard(newLeaderboard);

                        const data = loadStorageData();
                        saveStorageData({ ...data, leaderboard: newLeaderboard });
                    }, 600);
                }
            }, [matchedPairs, gameState, tries, playerName, leaderboard]);

            // Play again
            const playAgain = () => {
                setShowNewPlayerInput(false);
                setGameState(GAME_STATES.START);
            };

            // Handle player selection
            const handleSelectPlayer = (name) => {
                setPlayerName(name);
                setShowNewPlayerInput(false);
                startGame(name);
            };

            const handleNewPlayer = () => {
                setPlayerName('');
                setShowNewPlayerInput(true);
            };

            // Generate stars for background
            const stars = Array.from({ length: 50 }, (_, i) => ({
                id: i,
                left: Math.random() * 100,
                top: Math.random() * 100,
                size: 1 + Math.random() * 2,
                delay: Math.random() * 3,
            }));

            return (
                <div style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
                    padding: '20px',
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    position: 'relative',
                    overflow: 'hidden',
                }}>
                    {/* Animated stars background */}
                    {stars.map(star => (
                        <div
                            key={star.id}
                            style={{
                                position: 'absolute',
                                left: `${star.left}%`,
                                top: `${star.top}%`,
                                width: `${star.size}px`,
                                height: `${star.size}px`,
                                background: 'white',
                                borderRadius: '50%',
                                animation: `twinkle 2s ease-in-out ${star.delay}s infinite`,
                                pointerEvents: 'none',
                            }}
                        />
                    ))}

                    {/* Global styles */}
                    <style>{`
            @keyframes twinkle {
              0%, 100% { opacity: 0.3; }
              50% { opacity: 1; }
            }
            @keyframes float {
              0%, 100% { transform: translateY(0); }
              50% { transform: translateY(-10px); }
            }
            @keyframes shake {
              0%, 100% { transform: translateX(0); }
              25% { transform: translateX(-5px); }
              75% { transform: translateX(5px); }
            }
            @keyframes fadeIn {
              from { opacity: 0; transform: translateY(20px); }
              to { opacity: 1; transform: translateY(0); }
            }
            @keyframes bounce {
              0%, 100% { transform: scale(1); }
              50% { transform: scale(1.1); }
            }
            @keyframes confettiFall {
              0% { transform: translateY(0) rotate(0deg); opacity: 1; }
              100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
            }
            .card-container:hover:not(.matched) .card-inner {
              box-shadow: 0 0 20px rgba(255,255,255,0.3);
            }
            .matched {
              animation: matchPop 0.5s ease-out forwards;
            }
            @keyframes matchPop {
              0% { transform: scale(1); opacity: 1; }
              50% { transform: scale(1.1); }
              100% { transform: scale(0); opacity: 0; }
            }
          `}</style>

                    <div style={{
                        maxWidth: '800px',
                        margin: '0 auto',
                        position: 'relative',
                        zIndex: 1,
                    }}>
                        {/* Header */}


                        {/* Stats bar during game */}
                        {(gameState === GAME_STATES.PLAYING || gameState === GAME_STATES.PREVIEW) && (
                            <div style={{
                                display: 'flex',
                                justifyContent: 'center',
                                gap: '20px',
                                marginBottom: '15px',
                                flexWrap: 'wrap',
                            }}>
                                <div style={{
                                    background: 'rgba(255,255,255,0.1)',
                                    padding: '8px 20px',
                                    borderRadius: '25px',
                                    fontFamily: '"Roboto", cursive',
                                    color: 'white',
                                    fontSize: '1rem',
                                }}>
                                    üë§ {playerName}
                                </div>
                                <div style={{
                                    background: 'rgba(255,255,255,0.1)',
                                    padding: '8px 20px',
                                    borderRadius: '25px',
                                    fontFamily: '"Roboto", cursive',
                                    color: '#FFD93D',
                                    fontSize: '1rem',
                                }}>
                                    üéØ Tries: {tries}
                                </div>
                                <div style={{
                                    background: 'rgba(255,255,255,0.1)',
                                    padding: '8px 20px',
                                    borderRadius: '25px',
                                    fontFamily: '"Roboto", cursive',
                                    color: '#6BCB77',
                                    fontSize: '1rem',
                                }}>
                                    ‚ú® Pairs: {matchedPairs.length}/{totalCards}
                                </div>
                                <div style={{
                                    background: 'rgba(255,255,255,0.1)',
                                    padding: '8px 20px',
                                    borderRadius: '25px',
                                    fontFamily: '"Roboto", cursive',
                                    color: '#6BCB77',
                                    fontSize: '1rem',
                                }}>
                                    <button
                                        onClick={playAgain}
                                        style={{
                                            background: 'transparent',
                                            border: '2px solid #6BCB77',
                                            color: '#6BCB77',
                                            padding: '8px 20px',
                                            borderRadius: '25px',
                                            cursor: 'pointer',
                                        }}
                                    >
                                        Restart Game
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Start Screen */}
                        {gameState === GAME_STATES.START && (
                            <div style={{
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                gap: '25px',
                                animation: 'fadeIn 0.5s ease-out',
                            }}>
                                {/* Loading indicator */}
                                {!imagesLoaded && (
                                    <div style={{
                                        fontFamily: '"Roboto", cursive',
                                        color: '#FFD93D',
                                        fontSize: '1rem',
                                        animation: 'float 1s ease-in-out infinite',
                                    }}>
                                        Loading monsters... üé®
                                    </div>
                                )}

                                {/* Name input area */}
                                <div style={{
                                    background: 'rgba(255,255,255,0.1)',
                                    backdropFilter: 'blur(10px)',
                                    borderRadius: '24px',
                                    padding: '30px',
                                    border: '2px solid rgba(255,255,255,0.2)',
                                    width: '100%',
                                    maxWidth: '400px',
                                }}>
                                    {/* Player selector */}
                                    {knownPlayers.length > 0 && !showNewPlayerInput && (
                                        <PlayerSelector
                                            players={knownPlayers}
                                            selectedPlayer={playerName}
                                            onSelect={handleSelectPlayer}
                                            onNewPlayer={handleNewPlayer}
                                        />
                                    )}

                                    {/* New player input */}
                                    {(showNewPlayerInput || knownPlayers.length === 0) && (
                                        <>
                                            <h2 style={{
                                                fontFamily: '"Roboto", cursive',
                                                color: 'white',
                                                textAlign: 'center',
                                                marginBottom: '20px',
                                                fontSize: '1.3rem',
                                            }}>
                                                {knownPlayers.length > 0 ? 'New Player' : 'Enter Your Name'}
                                            </h2>
                                            <input
                                                type="text"
                                                value={playerName}
                                                onChange={(e) => setPlayerName(e.target.value)}
                                                onKeyDown={(e) => e.key === 'Enter' && startGame()}
                                                placeholder="Your awesome name..."
                                                maxLength={15}
                                                style={{
                                                    width: '100%',
                                                    padding: '14px 20px',
                                                    fontSize: '1.1rem',
                                                    borderRadius: '50px',
                                                    border: 'none',
                                                    background: 'rgba(255,255,255,0.9)',
                                                    fontFamily: '"Roboto", cursive',
                                                    textAlign: 'center',
                                                    outline: 'none',
                                                    boxShadow: '0 4px 20px rgba(0,0,0,0.2)',
                                                    marginBottom: '15px',
                                                    boxSizing: 'border-box',
                                                }}
                                            />
                                            {knownPlayers.length > 0 && (
                                                <button
                                                    onClick={() => {
                                                        setShowNewPlayerInput(false);
                                                        if (knownPlayers.length > 0) setPlayerName(knownPlayers[0]);
                                                    }}
                                                    style={{
                                                        width: '100%',
                                                        padding: '10px',
                                                        marginBottom: '15px',
                                                        background: 'transparent',
                                                        border: '1px solid rgba(255,255,255,0.3)',
                                                        borderRadius: '25px',
                                                        color: 'rgba(255,255,255,0.7)',
                                                        fontFamily: '"Roboto", cursive',
                                                        cursor: 'pointer',
                                                        fontSize: '0.9rem',
                                                    }}
                                                >
                                                    ‚Üê Back to player list
                                                </button>
                                            )}
                                        </>
                                    )}

                                    <button
                                        onClick={startGame}
                                        disabled={playerName.trim().length < 2 || !imagesLoaded}
                                        style={{
                                            width: '100%',
                                            padding: '14px 28px',
                                            fontSize: '1.2rem',
                                            fontFamily: '"Roboto", cursive',
                                            borderRadius: '50px',
                                            border: 'none',
                                            background: playerName.trim().length >= 2 && imagesLoaded
                                                ? 'linear-gradient(135deg, #6BCB77 0%, #4CAF50 100%)'
                                                : '#555',
                                            color: 'white',
                                            cursor: playerName.trim().length >= 2 && imagesLoaded ? 'pointer' : 'not-allowed',
                                            boxShadow: playerName.trim().length >= 2 && imagesLoaded
                                                ? '0 4px 20px rgba(107, 203, 119, 0.4)'
                                                : 'none',
                                            transition: 'all 0.3s ease',
                                        }}
                                    >
                                        üéÆ START üéÆ
                                    </button>
                                </div>

                                {/* Leaderboard and Grid Config */}
                                <div style={{ width: '100%', maxWidth: '400px' }}>
                                    <Leaderboard scores={leaderboard} gridRows={gridRows} gridCols={gridCols} onGridChange={handleGridChange} />
                                </div>

                                {/* Instructions */}
                                <div style={{
                                    background: 'rgba(255,255,255,0.05)',
                                    borderRadius: '16px',
                                    padding: '20px 25px',
                                    maxWidth: '450px',
                                    border: '1px solid rgba(255,255,255,0.1)',
                                }}>


                                </div>
                            </div>
                        )}

                        {/* Preview Screen */}
                        {gameState === GAME_STATES.PREVIEW && (
                            <div style={{ textAlign: 'center' }}>

                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: `repeat(${gridCols}, 1fr)`,
                                    gap: '8px',
                                    maxWidth: '600px',
                                    margin: '0 auto',
                                    justifyItems: 'center',
                                }}>
                                    {cards.map((card) => (
                                        <Card
                                            key={card.uniqueId}
                                            card={card}
                                            isFlipped={false}
                                            isMatched={false}
                                            previewMode={true}
                                            onClick={() => { }}
                                            gridSize={5}
                                        />
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Game Board */}
                        {gameState === GAME_STATES.PLAYING && (
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: `repeat(${gridCols}, 1fr)`,
                                gap: 'clamp(6px, 1.5vw, 12px)',
                                maxWidth: '800px',
                                margin: '0 auto',
                                padding: '10px',
                                background: 'rgba(255,255,255,0.05)',
                                borderRadius: '5px',
                                border: '2px solid rgba(255,255,255,0.1)',
                                justifyItems: 'center',
                            }}>
                                {cards.map((card, index) => (
                                    <Card
                                        key={card.uniqueId}
                                        card={card}
                                        isFlipped={flippedIndices.includes(index)}
                                        isMatched={matchedPairs.includes(card.id)}
                                        previewMode={false}
                                        onClick={() => handleCardClick(index)}
                                        gridSize={5}
                                    />
                                ))}
                            </div>
                        )}

                        {/* Win Screen */}
                        {gameState === GAME_STATES.WON && (
                            <>
                                <Confetti />
                                <div style={{
                                    textAlign: 'center',
                                    animation: 'fadeIn 0.5s ease-out',
                                }}>
                                    <div style={{
                                        fontSize: '4rem',
                                        marginBottom: '15px',
                                        animation: 'float 2s ease-in-out infinite',
                                    }}>
                                        üéâ
                                    </div>
                                    <h2 style={{
                                        fontFamily: '"Roboto", cursive',
                                        fontSize: 'clamp(1.8rem, 5vw, 2.5rem)',
                                        background: 'linear-gradient(135deg, #FFD93D 0%, #FF6B35 100%)',
                                        WebkitBackgroundClip: 'text',
                                        WebkitTextFillColor: 'transparent',
                                        marginBottom: '10px',
                                    }}>
                                        Amazing, {playerName}!
                                    </h2>
                                    <p style={{
                                        fontFamily: '"Roboto", cursive',
                                        fontSize: '1.3rem',
                                        color: 'white',
                                        marginBottom: '25px',
                                    }}>
                                        You matched all monsters in{' '}
                                        <span style={{ color: '#6BCB77', fontSize: '1.8rem' }}>
                                            {tries}
                                        </span>
                                        {' '}tries!
                                    </p>

                                    <button
                                        onClick={playAgain}
                                        style={{
                                            padding: '16px 35px',
                                            fontSize: '1.2rem',
                                            fontFamily: '"Roboto", cursive',
                                            borderRadius: '50px',
                                            border: 'none',
                                            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                            color: 'white',
                                            cursor: 'pointer',
                                            boxShadow: '0 4px 20px rgba(102, 126, 234, 0.4)',
                                            transition: 'transform 0.2s ease',
                                            marginBottom: '30px',
                                        }}
                                        onMouseEnter={(e) => e.target.style.transform = 'scale(1.05)'}
                                        onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
                                    >
                                        üîÑ Play Again!
                                    </button>

                                    <div style={{ maxWidth: '400px', margin: '0 auto' }}>
                                        <Leaderboard scores={leaderboard} gridRows={gridRows} gridCols={gridCols} onGridChange={handleGridChange} />
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MonsterMemory />);
    </script>
</body>

</html>